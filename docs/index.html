<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-Rails+ClusterId">Rails ClusterId</h1>

<p>A Ruby on Rails plugin for using <a href="https://github.com/tinychameleon/clusterid">ClusterId</a> values as primary keys.</p>

<p><a href="https://badge.fury.io/rb/rails-clusterid"><img src="https://badge.fury.io/rb/rails-clusterid.svg"></a></p>

<h2 id="label-What-27s+in+the+box-3F">Whatâ€™s in the box?</h2>

<p>âœ… Simple usage documentation written to get started fast. <a href="#usage">Check it out!</a></p>

<p>âš¡ A pretty fast implementation of Crockford32 in pure ruby. <a href="#benchmarks">Check it out!</a></p>

<p>ðŸ“š YARD generated API documentation for the library. <a href="https://tinychameleon.github.io/rails-clusterid/">Check it out!</a></p>

<p>ðŸ¤– RBS types for your type checking wants. <a href="./sig/rails-clusterid.rbs">Check it out!</a></p>

<p>ðŸ’Ž Tests against many Ruby versions. <a href="#ruby-versions">Check it out!</a></p>

<p>ðŸ”’ MFA protection on all gem owners. <a href="https://rubygems.org/gems/rails-clusterid">Check it out!</a></p>

<h2 id="label-Installation">Installation</h2>

<p>Add this line to your applicationâ€™s Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rails-clusterid</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>And then execute:</p>

<pre class="code ruby"><code class="ruby">$ bundle install
</code></pre>

<p>Or install it yourself as:</p>

<pre class="code ruby"><code class="ruby">$ gem install rails-clusterid
</code></pre>

<h3 id="label-Compatibility">Compatibility</h3>

<h4 id="label-Ruby+Versions">Ruby Versions</h4>

<p>This gem is tested against the following Ruby versions:</p>
<ul><li>
<p>2.7.5</p>
</li><li>
<p>3.0.3</p>
</li><li>
<p>3.1.1</p>
</li></ul>

<h4 id="label-Rails+Versions">Rails Versions</h4>

<p>This gem is tested against the following Ruby on Rails versions:</p>
<ul><li>
<p>7.0.x</p>
</li></ul>

<h2 id="label-Usage">Usage</h2>

<p>To use <code>ClusterId</code> values for all model primary keys automatically create a new initializer for your application.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># config/initializers/clusterid.rb
</span>
<span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_clusterid'>clusterid</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_add_generator'>add_generator</span><span class='lparen'>(</span><span class='symbol'>:default</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="ClusterId.html" title="ClusterId (module)">ClusterId</a></span></span><span class='op'>::</span><span class='const'>V1</span><span class='op'>::</span><span class='const'>Generator</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_generators'>generators</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_g'>g</span><span class='op'>|</span>
  <span class='id identifier rubyid_g'>g</span><span class='period'>.</span><span class='id identifier rubyid_orm'>orm</span> <span class='symbol'>:active_record</span><span class='comma'>,</span> <span class='label'>primary_key_type:</span> <span class='symbol'>:clusterid</span>
<span class='kw'>end</span>
</code></pre>

<p>The above configures the <code>rails-clusterid</code> plugin to use version 1 <code>ClusterId</code> values by default and configures ActiveRecord to use ClusterId values for primary keys. You must add a <code>:default</code> generator, and the generator itself is configurable. See the <a href="https://github.com/tinychameleon/clusterid">ClusterId repository for information on how to configure a generator</a>.</p>

<p>Once the initializers are complete, include the <code>ClusterId::Rails::Model</code> concern into your <code>ApplicationRecord</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app/models/application_record.rb
</span>
<span class='kw'>class</span> <span class='const'>ApplicationRecord</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>
  <span class='id identifier rubyid_primary_abstract_class'>primary_abstract_class</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="ClusterId.html" title="ClusterId (module)">ClusterId</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="ClusterId/Rails.html" title="ClusterId::Rails (module)">Rails</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="ClusterId/Rails/Model.html" title="ClusterId::Rails::Model (module)">Model</a></span></span>
<span class='kw'>end</span>
</code></pre>

<p>Migrations are supported and will automatically use ClusterId values as primary keys and foreign keys. This includes join tables.</p>

<h3 id="label-Manual+Usage">Manual Usage</h3>

<p>If you would like to selectively use <code>ClusterId</code> values across your models and migrations, just manually select the <code>:clusterid</code> type.</p>

<pre class="code ruby"><code class="ruby">$ rails g model person name:string --primary-key-type=clusterid
</code></pre>

<p>You can use it within migration files as well.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:people</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='symbol'>:clusterid</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span> <span class='symbol'>:name</span>
<span class='kw'>end</span>
</code></pre>

<p>Since the type works with ActiveRecord you can also specify it as a foreign key.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:hobbies</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='symbol'>:clusterid</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span> <span class='symbol'>:name</span>

  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_references'>references</span> <span class='symbol'>:person</span><span class='comma'>,</span> <span class='label'>null:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>foreign_key:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='symbol'>:clusterid</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="label-ClusterId+Ordering">ClusterId Ordering</h3>

<p>The ClusterId values are k-sortable and will be ordered by creation time before any other part of the ID. If you would like to read values from the ClusterId binary data stored within the database, you can deconstruct the raw data using a function.</p>

<p>For example, to extract the timestamp data while using PostgreSQL:</p>

<pre class="code ruby"><code class="ruby">to_timestamp((&#39;x&#39; || encode(substring(id for 8), &#39;hex&#39;))::bit(64)::bigint / 1000.0)
</code></pre>

<p>See the <a href="https://github.com/tinychameleon/clusterid">ClusterId repository for documentation about the binary representation</a>.</p>

<h3 id="label-More+Information">More Information</h3>

<p>For more detailed information about the library <a href="https://tinychameleon.github.io/rails-clusterid/">see the API documentation</a>.</p>

<h2 id="label-Contributing">Contributing</h2>

<h3 id="label-Development">Development</h3>

<p>This plugin relies heavily on Docker for development; ensure it is running to use most development commands.</p>

<p>To get started development on this gem run the <code>bin/setup</code> command. This will build the testing Docker image and run the tests and linting commands to ensure everything is working properly.</p>

<h3 id="label-Testing">Testing</h3>

<p>Use the <code>bundle exec rake test</code> command to run unit tests. To install the gem onto your local machine for general integration testing use <code>bundle exec rake install</code>.</p>

<p>To test the gem against each supported version of Ruby and databases use <code>bin/test_versions</code>. This will create a Docker image for each version and run the tests and linting steps.</p>

<h3 id="label-Releasing">Releasing</h3>

<p>Do the following to release a new version of this gem:</p>
<ul><li>
<p>Update the version number in <a href="./lib/rails-clusterid/version_rb.html">lib/rails-clusterid/version.rb</a></p>
</li><li>
<p>Ensure necessary documentation changes are complete</p>
</li><li>
<p>Ensure changes are in the <a href="./CHANGELOG_md.html">CHANGELOG.md</a></p>
</li><li>
<p>Create the new release using <code>bundle exec rake release</code></p>
</li></ul>

<p>After this is done the following side-effects should be visible:</p>
<ul><li>
<p>A new git tag for the version number should exist</p>
</li><li>
<p>Commits for the new version should be pushed to GitHub</p>
</li><li>
<p>The new gem should be available on <a href="https://rubygems.org">rubygems.org</a>.</p>
</li></ul>

<p>Finally, update the documentation hosted on GitHub Pages:</p>
<ul><li>
<p>Check-out the <code>gh-pages</code> branch</p>
</li><li>
<p>Merge <code>main</code> into the <code>gh-pages</code> branch</p>
</li><li>
<p>Generate the documentation with <code>bundle exec rake yard</code></p>
</li><li>
<p>Commit the documentation on the <code>gh-pages</code> branch</p>
</li><li>
<p>Push the new documentation so GitHub Pages can deploy it</p>
</li></ul>
</div></div>

      <div id="footer">
  Generated on Thu Mar 24 19:13:05 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-3.1.1).
</div>

    </div>
  </body>
</html>